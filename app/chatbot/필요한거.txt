1. PGDB 를 불러올떄 예시 "/DRF/lawService.do?OC=youngsunyi&target=prec&ID=233981&type=HTML&mobileYn=", 

prec= precedent id 

    json_api_url = f"https://www.law.go.kr/DRF/lawService.do?OC=youngsunyi&target=prec&ID={pre_number}&type=JSON"
    html_api_url = f"https://www.law.go.kr/DRF/lawService.do?OC=youngsunyi&target=prec&ID={pre_number}&type=HTML"


    consulation_id = 1342 같은걸로 추측 

    비교 
        "id": 1342,
    "category": "손해배상",
    "sub_category": "기타 손해배상",
    "title": "전기공작물의 하자와 한전의 책임",
    "question": "2003. 8. 오후 1시경 00아파트에서 이사작업을 하던 甲은 고가사다리가 2만2900V 상당의 고압전선에 사다리 끝부분이 닿아 사다리차에 고압 전류가 흐르게 되자 사다리차의 시동을 끄기 위해 운전석 문을 열었습니다. 그러나 이 문이 바로 옆에 주차된 화물트럭에 닿아 트럭에도 전류가 흐르면서 쇠로 된 도구, 일명 깔깔이를 이용해 이 트럭에 적재된 이삿짐을 묶는 작업을 하던 乙이 감전돼 숨졌습니다. 이 경우 乙의 유족들은 한전을 상대로 손해배상을 청구할 수 있는지요? 한전 측은 고압전선의 설치당시 법령상 요구되는 이격거리 등을 준수하였으므로 전선의 설치·보존상 하자는 없다고 주장합니다.",
    "answer": "「민법」 제758조 제1항은 “공작물의 설치 또는 보존의 하자로 인하여 타인에게 손해를 가한 때에는 공작물 점유자가 손해를 배상할 책임이 있다. 그러나 점유자가 손해의 방지에 필요한 주의를 해태하지 아니한 때에는 그 소유자가 손해를 배상할 책임이 있다.”라고 규정하고 있습니다. 또한 공작물의 설치·보존상의 하자는 공작물이 용도에 따라 통상 갖추어야 할 안전성을 갖추지 못한 상태에 있음을 말하는 것이며, 안전성의 구비 여부를 판단하기 위해서는 공작물의 설치·보존자가 그 공작물의 위험성에 비례해 사회통념상 일반적으로 요구되는 정도의 방호조치 의무를 다했는지의 여부를 기준으로 삼아야 한다는 것이 대법원 판례의 입장입니다. 위 사안에서 대법원 재판부는 \"피고(한전)는 아파트나 주택가 등 주거 밀집 지역에서 통상 행하여지는 이사작업을 위하여 금속제 고가사다리를 베란다에 붙인 후 그 사다리차의 적재함을 이용하여 인부와 함께 금속성 화물을 오르내리는 작업을 하고 마무리함으로써 다시 그 사다리를 접어내리는 일련의 과정 도중 감전사고가 발생할 위험성이 높다는 것을 능히 예견할 수 있었다\"며, \"피고(한전)가 이 사건 전선의 설치당시 법령 이격 거리 등을 준수하였다거나 이삿짐업체에 대하여 감전사고의 위험성을 알리는 공문을 발송하였다는 것만으로써는, 피고의 소유 내지 점유관리 하에 있는 (고압)전선에 관하여 사람에게 위해를 입히지 않도록 통상 갖추어야 할 안전성을 갖추도록 설치 · 보존상의 책임을 다하였다고 볼 수 없다\"고 밝혔습니다. 또 \"이러한 경우 피고로서는 일반 주민은 물론 이사작업을 담당하는 사람들로 하여금 전선의 존재와 위험성에 대하여 쉽게 알고 경각심을 가질 수 있도록 전선이나 지주물에 위험표지를 설치하였어야 할 것\"이라고 덧붙였습니다(대법원 2007. 6. 28. 선고 2007다10139 판결 참조). 이는 법원이 한전의 고압선 설치·보존상의 책임을 엄격히 판단한 판결이어서 더욱 주목받는 판례이기도 합니다. \n이에 따를 때 이격 거리 등을 준수하였다는 한전의 주장에도 불구하고, 이사 작업을 담당하는 인부들이 고압 전선의 존재와 위험성에 대해 쉽게 인지하고 경계할 수 있도록 하는 위험표지를 설치한 바가 없다면 이는 고압 전선 설치 및 보존상의 하자가 존재하는 것이므로, 乙의 유족들은 한전을 상대로 손해배상을 청구할 수 있으리라 판단됩니다."
  },
  {

      "id": 1342,
  "category": "손해배상",
  "sub_category": "기타 손해배상",
  "title": "전기공작물의 하자와 한전의 책임",
  "question": "2003. 8. 오후 1시경 00아파트에서 이사작업을 하던 甲은 고가사다리가 2만2900V 상당의 고압전선에 사다리 끝부분이 닿아 사다리차에 고압 전류가 흐르게 되자 사다리차의 시동을 끄기 위해 운전석 문을 열었습니다. 그러나 이 문이 바로 옆에 주차된 화물트럭에 닿아 트럭에도 전류가 흐르면서 쇠로 된 도구, 일명 깔깔이를 이용해 이 트럭에 적재된 이삿짐을 묶는 작업을 하던 乙이 감전돼 숨졌습니다. 이 경우 乙의 유족들은 한전을 상대로 손해배상을 청구할 수 있는지요? 한전 측은 고압전선의 설치당시 법령상 요구되는 이격거리 등을 준수하였으므로 전선의 설치·보존상 하자는 없다고 주장합니다.",
  "answer": "「민법」 제758조 제1항은 “공작물의 설치 또는 보존의 하자로 인하여 타인에게 손해를 가한 때에는 공작물 점유자가 손해를 배상할 책임이 있다. 그러나 점유자가 손해의 방지에 필요한 주의를 해태하지 아니한 때에는 그 소유자가 손해를 배상할 책임이 있다.”라고 규정하고 있습니다. 또한 공작물의 설치·보존상의 하자는 공작물이 용도에 따라 통상 갖추어야 할 안전성을 갖추지 못한 상태에 있음을 말하는 것이며, 안전성의 구비 여부를 판단하기 위해서는 공작물의 설치·보존자가 그 공작물의 위험성에 비례해 사회통념상 일반적으로 요구되는 정도의 방호조치 의무를 다했는지의 여부를 기준으로 삼아야 한다는 것이 대법원 판례의 입장입니다. 위 사안에서 대법원 재판부는 \"피고(한전)는 아파트나 주택가 등 주거 밀집 지역에서 통상 행하여지는 이사작업을 위하여 금속제 고가사다리를 베란다에 붙인 후 그 사다리차의 적재함을 이용하여 인부와 함께 금속성 화물을 오르내리는 작업을 하고 마무리함으로써 다시 그 사다리를 접어내리는 일련의 과정 도중 감전사고가 발생할 위험성이 높다는 것을 능히 예견할 수 있었다\"며, \"피고(한전)가 이 사건 전선의 설치당시 법령 이격 거리 등을 준수하였다거나 이삿짐업체에 대하여 감전사고의 위험성을 알리는 공문을 발송하였다는 것만으로써는, 피고의 소유 내지 점유관리 하에 있는 (고압)전선에 관하여 사람에게 위해를 입히지 않도록 통상 갖추어야 할 안전성을 갖추도록 설치 · 보존상의 책임을 다하였다고 볼 수 없다\"고 밝혔습니다. 또 \"이러한 경우 피고로서는 일반 주민은 물론 이사작업을 담당하는 사람들로 하여금 전선의 존재와 위험성에 대하여 쉽게 알고 경각심을 가질 수 있도록 전선이나 지주물에 위험표지를 설치하였어야 할 것\"이라고 덧붙였습니다(대법원 2007. 6. 28. 선고 2007다10139 판결 참조). 이는 법원이 한전의 고압선 설치·보존상의 책임을 엄격히 판단한 판결이어서 더욱 주목받는 판례이기도 합니다. \n이에 따를 때 이격 거리 등을 준수하였다는 한전의 주장에도 불구하고, 이사 작업을 담당하는 인부들이 고압 전선의 존재와 위험성에 대해 쉽게 인지하고 경계할 수 있도록 하는 위험표지를 설치한 바가 없다면 이는 고압 전선 설치 및 보존상의 하자가 존재하는 것이므로, 乙의 유족들은 한전을 상대로 손해배상을 청구할 수 있으리라 판단됩니다."
}



python -m app.models.create_search

python -m app.models.app



지금 문제: faiss유사도 검색 -> SQL ilike 검색으로 바꾸니 유동적인 gpt 데이터 보강이 힘듬

계획 :  llm 과정 2개 : 1. 변호사 감정가진놈 , 2. 변호사 지식을 가진놈 



다음 문제: api는 vector 변환할수 없음 -->


기존 플로우(성공) -> faiss bart/bert

중간 수정하고 실패한 플로우 -> sql(like) -> bart/ bert ; 유사도 검색이 절망적임 

새로 시작할 플로우 -> faiss검색->사용자 단어 유사도 기반 키워드 추출(5개)-> sql(like)검색-> bart/bert 정리

키워드 추출 -> 사용자 인풋 프롬트 faiss 검색 유사도 비교 후 가장 중요 키워드(단어)5개 추출 -> search_pre_limited

민사,형사... 같은 카테고리형 데이터 = 따로 search_precedents_by_category 쓰지 말고 바로search_pre_limited 에 넣음 

즉  search_pre_limited = 최중요5단어 + 카테고리(민사,형사...etc) -> bart(이제는 요약 기능을 담당할것임) -> llm 들어가기 
|
|-----> bart 후 -> bert = 판결 예측 모델(예측 수행)

 bert 결과물도 키워드 5단어만 추출함 

즉 llm에 bart 와 bert 결과물이 들어갈것임 

https://blossoming-man.tistory.com/entry/python-%EB%A9%94%EB%AA%A8%EB%A6%AC%EC%99%80%EC%9D%98-%EC%A0%84%EC%9F%81%EC%A2%85%EC%A7%80%EB%B6%80-konlpy%EB%A5%BC-%EB%B2%84%EB%A6%AC%EA%B3%A0-PyKomoran%EC%9D%84-%EC%84%A0%ED%83%9D%ED%95%98%EB%8B%A4 

현재 문제: 
🔍 [FAISS 키워드 추출] 입력: 식중독 위생법\
✅ [FAISS 추출 키워드] ['responses', '경우', '또는', '식품위생법', '있는']
✅ [키워드 기반 SQL 검색] responses 경우 또는 식품위생법 있는
✅ [SQL 판례 검색 결과] 검색된 판례 개수: 0 

형태소 추출 해야함 

kiwipiepy

정확도를 위해 자카드 유사도 활용 


지금: 단어 5개 뽑아서 검색 -> 가장 top_k인 값을 뽑아서 
sql 검색 실행후 비슷한 판례"따로따로" -> ex: 위 (지금 문제: AI가 너무 자의적으로 해석된 데이터를 가져갈수 있음 )

문제: 이미 5개 단어 뽑은걸 또 따로따로 검색하면 새로 해석할수 있음 :

바꾸어야하는거: 

검색 키워드 "가중 폭행 운전자 범죄 처벌"  이렇게 한 뭉치로 정의 (noun만 추출) 


keyword: 앞에 민사, 형사 판사 같은 카테고리 붙이고 검색 


conda activate C:\conda_envs\test_env

uvicorn app.chatbot.app:app --reload  

python -m app.chatbot.main




